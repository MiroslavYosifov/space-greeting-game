<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Space Birthday Shooter üöÄüéÇ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #020617;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
    }

    .wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 16px;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      font-size: 22px;
      letter-spacing: 0.5px;
      text-align: center;
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.85;
      text-align: center;
      max-width: 520px;
      line-height: 1.4;
    }

    canvas {
      border: 4px solid #4f46e5;
      border-radius: 12px;
      background: black;
      image-rendering: pixelated;
      touch-action: none; /* –¥–∞ –Ω–µ —Å–∫—Ä–æ–ª–≤–∞ –ø—Ä–∏ swipe –≤—ä—Ä—Ö—É canvas */
    }

    .hint {
      font-size: 12px;
      opacity: 0.7;
      text-align: center;
    }

    /* Touch –∫–æ–Ω—Ç—Ä–æ–ª–∏ */
    .controls {
      display: flex;
      gap: 12px;
      margin-top: 6px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .ctrl-group {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .ctrl-label {
      font-size: 11px;
      opacity: 0.7;
    }

    .ctrl-btn {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease;
    }

    .ctrl-btn:active,
    .ctrl-btn.is-active {
      transform: translateY(1px);
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.6);
      background: rgba(30, 64, 175, 0.9);
    }

    .overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.85);
      z-index: 10;
    }

    .overlay.visible {
      display: flex;
    }

    .overlay-card {
      background: #020617;
      border-radius: 20px;
      padding: 22px 22px 26px;
      max-width: 420px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
      text-align: center;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .overlay-card h2 {
      font-size: 20px;
      margin-bottom: 8px;
    }

    .overlay-card p {
      font-size: 14px;
      margin-bottom: 16px;
      line-height: 1.5;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      background: #4f46e5;
      color: white;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(79, 70, 229, 0.5);
      background: #6366f1;
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-secondary {
      margin-top: 8px;
      background: transparent;
      color: #9ca3af;
      box-shadow: none;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .btn-secondary:hover {
      background: rgba(15, 23, 42, 0.9);
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.7);
    }

    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 14px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 20;
      max-width: 90%;
      text-align: center;
    }

    .toast.visible {
      opacity: 1;
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 19px;
      }
      .subtitle {
        font-size: 13px;
      }
      .hint {
        font-size: 11px;
      }
      .ctrl-btn {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Space Birthday Shooter üöÄüéÇ</h1>
    <p class="subtitle">
      –£–ø—Ä–∞–≤–ª—è–≤–∞–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏—è –∫–æ—Ä–∞–±, –∏–∑–±—è–≥–≤–∞–π –∞—Å—Ç–µ—Ä–æ–∏–¥–∏—Ç–µ –∏ —Å—Ç–∏–≥–Ω–∏ –¥–æ —Ç–æ—Ä—Ç–∞—Ç–∞-–ø–ª–∞–Ω–µ—Ç–∞.
      <br>–ö–æ–≥–∞—Ç–æ —è –¥–æ–∫–æ—Å–Ω–µ—à, —â–µ –æ—Ç–∫–ª—é—á–∏—à —Å–ø–µ—Ü–∏–∞–ª–Ω–æ —Ä–æ–∂–¥–µ–Ω–¥–µ–Ω—Å–∫–æ –ø–æ—Å–ª–∞–Ω–∏–µ.
    </p>

    <canvas id="game" width="400" height="225"></canvas>

    <p class="hint">
      –ù–∞ –∫–æ–º–ø—é—Ç—ä—Ä: <b>W / ‚Üë</b> –∏ <b>S / ‚Üì</b> –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ, <b>Space</b> –∑–∞ —Å—Ç—Ä–µ–ª–±–∞.
      <br>–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω: –∏–∑–ø–æ–ª–∑–≤–∞–π –±—É—Ç–æ–Ω–∏—Ç–µ –æ—Ç–¥–æ–ª—É.
    </p>

    <div class="controls" aria-hidden="false">
      <div class="ctrl-group">
        <span class="ctrl-label">–î–≤–∏–∂–µ–Ω–∏–µ</span>
        <button type="button" class="ctrl-btn" data-action="up">‚ñ≤</button>
        <button type="button" class="ctrl-btn" data-action="down">‚ñº</button>
      </div>
      <div class="ctrl-group">
        <span class="ctrl-label">–°—Ç—Ä–µ–ª–±–∞</span>
        <button type="button" class="ctrl-btn" data-action="fire">üî´</button>
      </div>
    </div>
  </div>

  <!-- –§–∏–Ω–∞–ª–µ–Ω overlay —Å –ø–æ–∂–µ–ª–∞–Ω–∏–µ -->
  <div class="overlay" id="winOverlay">
    <div class="overlay-card">
      <h2>–ß–µ—Å—Ç–∏—Ç —Ä–æ–∂–¥–µ–Ω –¥–µ–Ω, –∫–∞–ø–∏—Ç–∞–Ω–µ! üåå</h2>
      <p>
        –ü–æ–∂–µ–ª–∞–≤–∞–º —Ç–∏ –±–µ–∑–∫—Ä–∞–π–Ω–∏ –≥–∞–ª–∞–∫—Ç–∏–∫–∏ –æ—Ç –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Å—Ç–∞–±–∏–ª–µ–Ω FPS,
        –ª–µ–≥–µ–Ω–¥–∞—Ä–µ–Ω loot –∏ –Ω–∏—Ç–æ –µ–¥–∏–Ω game-breaking bug –ø–æ –ø—ä—Ç—è —Ç–∏.
        –ù–µ–∫–∞ –≤—Å—è–∫–æ –Ω–∏–≤–æ –æ—Ç –∂–∏–≤–æ—Ç–∞ —Ç–∏ –±—ä–¥–µ –ø–æ-–µ–ø–∏—á–Ω–æ –æ—Ç –ø—Ä–µ–¥–∏—à–Ω–æ—Ç–æ. üéÆüöÄ
      </p>
      <button class="btn" id="restartBtn">
        –ò–≥—Ä–∞–π –æ—Ç–Ω–æ–≤–æ üîÅ
      </button>
      <button class="btn btn-secondary" id="closeBtn">
        –ó–∞—Ç–≤–æ—Ä–∏ –∫–∞—Ä—Ç–∏—á–∫–∞—Ç–∞ ‚ú®
      </button>
    </div>
  </div>

  <div class="toast" id="toast">–û–ø–∞! –£–¥–∞—Ä–∏ —Å–µ –≤ –∞—Å—Ç–µ—Ä–æ–∏–¥. –û–ø–∏—Ç–∞–π –ø–∞–∫. üí•</div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      const scale = Math.min(
        window.innerWidth / 450,
        window.innerHeight / 320,
        2.6
      );
      canvas.style.width = canvas.width * scale + "px";
      canvas.style.height = canvas.height * scale + "px";
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    const keys = {};
    document.addEventListener("keydown", (e) => {
      keys[e.code] = true;
      if (["ArrowUp", "ArrowDown", "Space"].includes(e.code)) {
        e.preventDefault();
      }
    });
    document.addEventListener("keyup", (e) => {
      keys[e.code] = false;
    });

    // Touch / click –∫–æ–Ω—Ç—Ä–æ–ª–∏
    const controlMap = {
      up: ["ArrowUp", "KeyW"],
      down: ["ArrowDown", "KeyS"],
      fire: ["Space"],
    };

    function setControl(action, isActive) {
      const codes = controlMap[action] || [];
      codes.forEach((code) => {
        keys[code] = isActive;
      });
    }

    const ctrlButtons = document.querySelectorAll(".ctrl-btn");
    ctrlButtons.forEach((btn) => {
      const action = btn.dataset.action;

      const start = (e) => {
        e.preventDefault();
        btn.classList.add("is-active");
        setControl(action, true);
      };

      const end = (e) => {
        e.preventDefault();
        btn.classList.remove("is-active");
        setControl(action, false);
      };

      btn.addEventListener("touchstart", start, { passive: false });
      btn.addEventListener("touchend", end, { passive: false });
      btn.addEventListener("touchcancel", end, { passive: false });
      btn.addEventListener("mousedown", start);
      btn.addEventListener("mouseup", end);
      btn.addEventListener("mouseleave", end);
    });

    document.addEventListener("contextmenu", (e) => {
      // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ –¥—ä–ª–≥–æ-–Ω–∞—Ç–∏—Å–∫–∞–Ω–µ –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª–Ω–∏
      if (e.target.classList.contains("ctrl-btn")) {
        e.preventDefault();
      }
    });

    // –ò–≥—Ä–æ–≤–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏
    const PLAYER_SPEED = 110;
    const BULLET_SPEED = 230;
    const ENEMY_MIN_SPEED = 60;
    const ENEMY_MAX_SPEED = 120;
    const SHOOT_COOLDOWN = 0.25;
    const TIME_BEFORE_CAKE = 25;
    const KILLS_BEFORE_CAKE = 10;

    const player = {
      x: 40,
      y: canvas.height / 2 - 8,
      w: 18,
      h: 12,
      shootTimer: 0
    };

    let bullets = [];
    let enemies = [];
    let cake = null;
    let lastTime = 0;
    let elapsedTime = 0;
    let spawnTimer = 0;
    let spawnInterval = 1.3;
    let gameWon = false;
    let kills = 0;

    const stars = [];
    for (let i = 0; i < 90; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 0.9 + 0.3,
        tw: Math.random() * Math.PI * 2
      });
    }

    const toastEl = document.getElementById("toast");
    let toastTimeout = null;
    function showToast(msg) {
      toastEl.textContent = msg;
      toastEl.classList.add("visible");
      if (toastTimeout) clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => {
        toastEl.classList.remove("visible");
      }, 1700);
    }

    function update(dt, timestamp) {
      if (gameWon) return;

      elapsedTime += dt;
      spawnTimer += dt;
      player.shootTimer -= dt;

      // –î–≤–∏–∂–µ–Ω–∏–µ ‚Äì –≤–µ—Ä—Ç–∏–∫–∞–ª–Ω–æ
      if (keys["ArrowUp"] || keys["KeyW"]) {
        player.y -= PLAYER_SPEED * dt;
      }
      if (keys["ArrowDown"] || keys["KeyS"]) {
        player.y += PLAYER_SPEED * dt;
      }

      // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
      if (player.y < 10) player.y = 10;
      if (player.y + player.h > canvas.height - 10) {
        player.y = canvas.height - 10 - player.h;
      }

      // –°—Ç—Ä–µ–ª–±–∞
      const wantsToShoot = keys["Space"];
      if (wantsToShoot && player.shootTimer <= 0) {
        shootBullet();
        player.shootTimer = SHOOT_COOLDOWN;
      }

      bullets.forEach((b) => {
        b.x += BULLET_SPEED * dt;
      });
      bullets = bullets.filter((b) => b.x < canvas.width + 40 && !b.dead);

      // Spawn –≤—Ä–∞–≥–æ–≤–µ
      if (!cake && spawnTimer >= spawnInterval) {
        spawnEnemy();
        spawnTimer = 0;
        spawnInterval = 0.6 + Math.random() * 0.9;
      }

      enemies.forEach((e) => {
        e.x += e.vx * dt;
        e.y += e.vy * dt;
        e.lifeTime += dt;
      });
      enemies = enemies.filter((e) => e.x > -40 && e.lifeTime < 20 && !e.dead);

      // –ö–æ–ª–∏–∑–∏–∏ bullet‚Äìenemy
      for (const b of bullets) {
        for (const e of enemies) {
          if (!b.dead && !e.dead && rectsOverlap(b, e)) {
            b.dead = true;
            e.dead = true;
            kills++;
          }
        }
      }

      // –ö–æ–ª–∏–∑–∏–∏ player‚Äìenemy
      for (const e of enemies) {
        if (!e.dead && rectsOverlap(player, e)) {
          showToast("–û–ø–∞! –£–¥–∞—Ä–∏ —Å–µ –≤ –∞—Å—Ç–µ—Ä–æ–∏–¥. –û–ø–∏—Ç–∞–π –ø–∞–∫. üí•");
          resetGame();
          return;
        }
      }

      // –ü–æ—è–≤–∞ –Ω–∞ —Ç–æ—Ä—Ç–∞—Ç–∞
      if (!cake && (elapsedTime >= TIME_BEFORE_CAKE || kills >= KILLS_BEFORE_CAKE)) {
        spawnCake();
      }

      // –™–ø–¥–µ–π—Ç —Ç–æ—Ä—Ç–∞
      if (cake) {
        cake.x += cake.vx * dt;
        cake.y += Math.sin(timestamp / 500) * 0.02 * canvas.height;
        if (cake.x < -60) {
          spawnCake();
        }
        if (rectsOverlap(player, cake)) {
          winGame();
        }
      }
    }

    function rectsOverlap(a, b) {
      return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
      );
    }

    function shootBullet() {
      bullets.push({
        x: player.x + player.w - 2,
        y: player.y + player.h / 2 - 1,
        w: 6,
        h: 2,
        dead: false
      });
    }

    function spawnEnemy() {
      const y = 15 + Math.random() * (canvas.height - 30);
      const size = 10 + Math.random() * 10;
      const speed = -(ENEMY_MIN_SPEED + Math.random() * (ENEMY_MAX_SPEED - ENEMY_MIN_SPEED));
      const vy = (Math.random() - 0.5) * 20;

      enemies.push({
        x: canvas.width + 20,
        y,
        w: size,
        h: size,
        vx: speed,
        vy: vy,
        dead: false,
        lifeTime: 0
      });
    }

    function spawnCake() {
      cake = {
        x: canvas.width + 40,
        y: 40 + Math.random() * (canvas.height - 80),
        w: 26,
        h: 24,
        vx: -30
      };
    }

    function drawStars(time) {
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      for (const s of stars) {
        const twinkle = (Math.sin(time / 500 + s.tw) + 1) / 2;
        const alpha = 0.3 + 0.7 * twinkle;
        ctx.globalAlpha = alpha;
        ctx.fillStyle = "white";
        const x = (s.x - time * 0.03 + canvas.width) % canvas.width;
        ctx.fillRect(x, s.y, s.r, s.r);
      }
      ctx.globalAlpha = 1;
    }

    function drawPlayer() {
      const x = player.x;
      const y = player.y;

      ctx.fillStyle = "#e5e7eb";
      ctx.fillRect(x, y + 3, player.w, player.h - 4);

      ctx.fillStyle = "#f97316";
      ctx.fillRect(x + player.w - 4, y + 4, 5, 4);

      ctx.fillStyle = "#9ca3af";
      ctx.fillRect(x + 2, y + player.h - 3, player.w - 6, 3);
      ctx.fillRect(x + 2, y, player.w - 6, 3);

      ctx.fillStyle = "#0f172a";
      ctx.fillRect(x + 4, y + 4, 6, 4);

      ctx.fillStyle = "#4b5563";
      ctx.fillRect(x - 3, y + 4, 3, 3);
      ctx.fillRect(x - 3, y + player.h - 6, 3, 3);

      const flame = (Math.sin(performance.now() / 80) + 1) / 2;
      ctx.fillStyle = flame > 0.5 ? "#f59e0b" : "#facc15";
      ctx.fillRect(x - 4, y + 4, 2, 2);
      ctx.fillRect(x - 4, y + player.h - 6, 2, 2);
    }

    function drawBullets() {
      ctx.fillStyle = "#a5b4fc";
      bullets.forEach((b) => {
        ctx.fillRect(b.x, b.y, b.w, b.h);
      });
    }

    function drawEnemies() {
      enemies.forEach((e) => {
        ctx.fillStyle = "#4b5563";
        ctx.fillRect(e.x, e.y, e.w, e.h);
        ctx.fillStyle = "#9ca3af";
        ctx.fillRect(e.x + 2, e.y + 2, e.w - 4, e.h - 4);
        ctx.fillStyle = "#111827";
        ctx.fillRect(e.x + e.w / 2 - 2, e.y + e.h / 2 - 2, 3, 3);
      });
    }

    function drawCake() {
      if (!cake) return;
      const x = cake.x;
      const y = cake.y;

      ctx.fillStyle = "#fb7185";
      ctx.fillRect(x, y + 8, cake.w, cake.h - 8);

      ctx.fillStyle = "#fecdd3";
      ctx.fillRect(x, y + 4, cake.w, 6);

      ctx.fillStyle = "#f97316";
      ctx.fillRect(x - 4, y + cake.h / 2, cake.w + 8, 3);

      ctx.fillStyle = "#e5e7eb";
      for (let i = 0; i < 3; i++) {
        const cx = x + 5 + i * 5;
        ctx.fillRect(cx, y, 2, 5);
        ctx.fillStyle = "#fde047";
        ctx.fillRect(cx, y - 2, 2, 2);
        ctx.fillStyle = "#e5e7eb";
      }
    }

    function drawHUD() {
      ctx.fillStyle = "#e5e7eb";
      ctx.font = "7px monospace";
      ctx.fillText("SPACE BIRTHDAY SHOOTER", 10, 12);
      ctx.fillText("–£–Ω–∏—â–æ–∂–µ–Ω–∏ –∞—Å—Ç–µ—Ä–æ–∏–¥–∏: " + kills, 10, 22);
      ctx.fillText("–í—Ä–µ–º–µ: " + Math.floor(elapsedTime) + "s", 10, 32);
      if (!cake) {
        ctx.fillText("–û—Ü–µ–ª–µ–π –∏ —Å—Ç–∏–≥–Ω–∏ –¥–æ —Ç–æ—Ä—Ç–∞—Ç–∞!", 190, 12);
      } else {
        ctx.fillText("–¢–æ—Ä—Ç–∞—Ç–∞ –µ –Ω–∞–±–ª–∏–∑–æ! üéÇ", 210, 12);
      }
    }

    function gameLoop(timestamp) {
      const dt = (timestamp - lastTime) / 1000;
      lastTime = timestamp;

      update(dt, timestamp);
      drawStars(timestamp);
      drawCake();
      drawEnemies();
      drawBullets();
      drawPlayer();
      drawHUD();

      requestAnimationFrame(gameLoop);
    }

    function resetGame() {
      player.x = 40;
      player.y = canvas.height / 2 - 8;
      player.shootTimer = 0;
      bullets = [];
      enemies = [];
      cake = null;
      elapsedTime = 0;
      spawnTimer = 0;
      gameWon = false;
      kills = 0;
      document.getElementById("winOverlay").classList.remove("visible");
    }

    function winGame() {
      gameWon = true;
      document.getElementById("winOverlay").classList.add("visible");
    }

    const winOverlay = document.getElementById("winOverlay");
    const restartBtn = document.getElementById("restartBtn");
    const closeBtn = document.getElementById("closeBtn");

    restartBtn.addEventListener("click", () => {
      resetGame();
    });

    closeBtn.addEventListener("click", () => {
      winOverlay.classList.remove("visible");
    });

    requestAnimationFrame((t) => {
      lastTime = t;
      requestAnimationFrame(gameLoop);
    });
  </script>
</body>
</html>
